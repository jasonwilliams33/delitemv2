<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[api.controller=function($scope,delitemModalPubSub) {
	/* widget controller */
	var c = this;

	c.data.selectedDeliveryArr = [];
	c.data.deliverySelected = false;

	c.data.disabled = true;

	c.selectDelivery = function(sys_id) {

		var selectedItemIndex = c.data.selectedDeliveryArr.indexOf(sys_id);

		if(selectedItemIndex == -1) {

			c.data.selectedDeliveryArr.push(sys_id);

		} else {

			c.data.selectedDeliveryArr.splice(selectedItemIndex, 1);

		}

		if(c.data.selectedDeliveryArr.length > 0) { 

			c.data.disabled = false;

		} else {

			c.data.disabled = true;

		}

	}

	c.sendReminders = function(action) {

		if(action == "all") {

			c.data.selectedDeliveryArr = c.data.outstandingDeliveryArr;

		}

		c.server.get({

			action: "sendReminders",
			selectedDeliveryArr: c.data.selectedDeliveryArr

		}).then(function(rsp) {
			
			var modalReturnObj = {
				
				"modalAction" : "remindersSent"
			
			}
		
		delitemModalPubSub.publish(modalReturnObj);
			
		})

	}

	c.cancel = function() {

		var modalReturnObj = {

			"modalAction" : "cancel"

		}

		delitemModalPubSub.publish(modalReturnObj);

	}

};]]></client_script>
        <controller_as>c</controller_as>
        <css>.panel-heading{
  color: #fff;
  background-color: $brand-primary;
}

.headingText{
  text-align: center;
}

.btn span.glyphicon {    			
	opacity: 0;
}

.btn.active span.glyphicon {				
	opacity: 1;		
  color: #ffffff;
}

.btn.active{
  background: $brand-primary;
  color: #ffffff;
}

.btn span.glyphicon {    			
	opacity: 0;
}

.btn.active span.glyphicon {				
	opacity: 1;		
  color: #ffffff;
}

.btn.active{
  background: $brand-primary;
  color: #ffffff;
}


.btn input{
	display:none;
}

.collectDelivery{
  margin-top: 10px;	
}

.outer{
	background-color: #ffffff;
  border: solid 1px;
}

.inner{
	background-color: $brand-primary;
  border-radius: 5px;
  //background-image: linear-gradient(to right top, #1f8476, #22957f, #2ba686, #38b78c, #48c891);
  border: solid 1px;

}

.collectBtns{
	margin: 5px;
  margin-top: 10px;
}

.headingText{
	text-align: center;
  color: #ffffff;
}</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>true</has_preview>
        <id>delitem_reminders</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {  }]]></link>
        <name>Delitem Reminders</name>
        <option_schema/>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function() {
	/* populate the 'data' object */
	/* e.g., data.table = $sp.getValue('table'); */

	data.options = input || '';

	data.outstandingDeliveryArr = [];

	try {

		var deliveryGRS = new GlideRecordSecure(DelItemConstants.DELIVERY_TABLE);
		deliveryGRS.addEncodedQuery("state!=" + DelItemConstants.COLLECTED);
		deliveryGRS.query();
		while(deliveryGRS.next()) {

			data.outstandingDeliveryObj = {};
			data.outstandingDeliveryObj.recipient = deliveryGRS.recipient.getDisplayValue();
			data.outstandingDeliveryObj.delivery_items_awaiting_collection = deliveryGRS.delivery_items_awaiting_collection.toString();
			data.outstandingDeliveryObj.sys_id = deliveryGRS.getUniqueValue();
			data.outstandingDeliveryArr.push(data.outstandingDeliveryObj);

		}

	} catch(err) {

		gs.error('['+gs.getCurrentScopeName()+']' + ': Delitem Reminders widget - Caught error: \n'+err);

	}
	
	if(input && input.action == "sendReminders") {
		
		var sendReminders = new x_187394_delitem.DelitemUtils().sendReminders(input.selectedDeliveryArr);
		
	}

})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2023-02-10 20:46:48</sys_created_on>
        <sys_id>7b3d42772f382150758993acf699b6dc</sys_id>
        <sys_mod_count>4</sys_mod_count>
        <sys_name>Delitem Reminders</sys_name>
        <sys_package display_value="Delitem" source="x_187394_delitem">ac22a5c32f771110758993acf699b6da</sys_package>
        <sys_policy/>
        <sys_scope display_value="Delitem">ac22a5c32f771110758993acf699b6da</sys_scope>
        <sys_update_name>sp_widget_7b3d42772f382150758993acf699b6dc</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2023-04-20 10:17:17</sys_updated_on>
        <template><![CDATA[<div class="panel panel-default"
     ng-show="!c.data.deliverySelected">
  <table class="table table-striped table-primary table-responsive">
    <thead>
      <tr>
        <th>Recipient</th> 
        <th>Delivery Items Awaiting Collection</th>
        <th ng-show="c.data.outstandingDeliveryArr.length > 1">Select</th>
      </tr>
    </thead>
    <tbody>
      <tr ng-repeat="delivery in c.data.outstandingDeliveryArr">
        <td>{{delivery.recipient}}</td>
        <td>{{delivery.delivery_items_awaiting_collection}}</td>
        <td ng-show="c.data.outstandingDeliveryArr.length > 1">
          <div class="btn-group" data-toggle="buttons">	
            <label class="btn btn-default btn-sm" 
                   ng-click="c.selectDelivery(delivery.sys_id)"
                   ng-class="{'active': !!delivery.selected}">
              <input type="checkbox" name="singleCheck">
              <span class="glyphicon glyphicon-ok"></span>
            </label>
          </div>          
        </td>
      </tr>
  </table>  
</div>
<div ng-show="!c.data.deliverySelected">
       <button class=" btn btn-default collectBtns"
          ng-click="c.cancel()">
    Cancel
  </button>
      <button class="btn btn-primary collectBtns pull-right"
          ng-show="c.data.outstandingDeliveryArr.length > 1"
          ng-disabled="c.data.disabled"
          ng-click="c.sendReminders('selected')">
    Send Selected
  </button> 
  <button class=" btn btn-primary collectBtns pull-right"
          ng-click="c.sendReminders('all')">
    Send <span ng-show="c.data.outstandingDeliveryArr.length > 1">All</span>
  </button>
    </div>]]></template>
    </sp_widget>
</record_update>
